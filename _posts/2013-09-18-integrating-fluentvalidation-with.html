---
layout: post
title: Integrating FluentValidation with ASP.NET Web API
date: '2013-09-18T18:48:00.002-07:00'
author: Leo Hernandez
tags: 
modified_time: '2014-10-25T19:02:02.205-07:00'
blogger_id: tag:blogger.com,1999:blog-3785659521516138827.post-1634106813973232049
blogger_orig_url: http://www.leojh.com/2013/09/integrating-fluentvalidation-with.html
---

<div dir="ltr" style="margin-bottom: 0pt; margin-top: 0pt;"><div style="line-height: 1.15;"><span style="font-family: Arial; font-size: 15px; line-height: 1.15; white-space: pre-wrap;">In short, we dislike the Validation that comes with MVC and, now, Web Api. No need to go into why here, but things like Attribute dependencies and its clunky API are bad …. m’kay. </span><span style="color: black; vertical-align: baseline;"><br /></span></div><span style="color: black; vertical-align: baseline;"><a href="https://github.com/JeremySkinner/FluentValidation">Fluent Validation</a> </span><span style="color: black; font-family: Arial; font-size: 15px; line-height: 1.15; vertical-align: baseline; white-space: pre-wrap;">is a popular, open-source, fluent-API based validation engine for .Net that we prefer&nbsp;</span><span style="font-family: Arial; font-size: 15px; line-height: 1.15; white-space: pre-wrap;">over the default validation. There are several ways of integrating Web Api with Fluent Validations.&nbsp;</span><br /><span style="color: black; font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;"><br /></span><span style="color: black; font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;">Some of those are explained <a href="http://brettedotnet.wordpress.com/2013/05/01/asp-net-web-api-validation-a-one-more-better-approach/">here</a> and </span><span style="font-family: Arial; font-size: 15px; line-height: 1.15; white-space: pre-wrap;"><a href="http://fluentvalidation.codeplex.com/SourceControl/network/forks/havard/webapisupport">here</a>.</span><br /><span style="font-family: Arial; font-size: 15px; line-height: 1.15; white-space: pre-wrap;"><br /></span><span style="font-family: Arial; font-size: 15px; line-height: 1.15; white-space: pre-wrap;">Initially, we went with a custom implementation of the latter since it hooks right into the Model property of ActionContext of an ActionFilter. This is nice because the Validation action filter would only need to verify that the ModelState.IsValid is true, or else, return an HTTP Bad Request Response (400) with the error messages.</span><br /><span style="font-family: Arial; font-size: 15px; line-height: 1.15; white-space: pre-wrap;"><br /></span><span style="font-family: Arial; font-size: 15px; line-height: 1.15; white-space: pre-wrap;">However, we cringed at bringing a custom implementation of this library that includes a lot of extra artifacts and seems to no longer be active.</span><br /><span style="font-family: Arial; font-size: 15px; line-height: 1.15; white-space: pre-wrap;"><br /></span><span style="font-family: Arial; font-size: 15px; line-height: 1.15; white-space: pre-wrap;">At one point, we realized that we could hook right into the ArgumentsProperty of the ActionContext. In this case, we can ask the Dependency Injection Container (we use <a href="http://docs.structuremap.net/">StrucutreMap</a>) for the validator for the type, then execute the validation. </span></div><div dir="ltr" style="margin-bottom: 0pt; margin-top: 0pt;"><div style="line-height: 1.15;"><span style="background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Although we lose the nice ModelState.IsValid hook, we make it up by having a less-magical, more explicit implementation for validation that is easier to maintain and debug.</span></div><div style="line-height: 1.15;"><span style="font-family: Arial; font-size: 15px; line-height: 1.15; white-space: pre-wrap;"><br /></span><span style="font-family: Arial; font-size: 15px; line-height: 1.15; white-space: pre-wrap;">In order to get the container to get us the right Validator for the type, we need to register all types that Implement the “AbstractValidator&lt;&gt;” interface.</span></div><div style="line-height: 1.15;"><span style="font-family: Arial; font-size: 15px; white-space: pre-wrap;"><br /></span><span style="font-family: Arial; font-size: 15px; white-space: pre-wrap;">By the way, these Validators are also easily unit testable.</span></div><div style="line-height: 1.15;"><span style="font-family: Arial; font-size: 15px; white-space: pre-wrap;"><br /></span><span style="font-family: Arial; font-size: 15px; white-space: pre-wrap;">All the necessary, simplified code is found below:</span></div></div><script src="https://gist.github.com/leojh/6618093.js"></script>